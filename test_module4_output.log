
================================================================================
MODULE 4 - PURCHASES (CORE PURCHASE ENTRY) - TEST SUITE
================================================================================

Running comprehensive tests for MODULE 4 requirements...

‚úÖ Login successful

================================================================================
TEST 1: Single Item Purchase with 22K Valuation (purity ‚â† 22K)
================================================================================

üìù Test Data:
   Vendor: Axe
   Weight: 10.5g
   Entered Purity: 999K (24K)
   Conversion Factor: 0.92
   Expected Amount (22K valuation): 10454.35 OMR
   Formula: (10.5 √ó 916) √∑ 0.92 = 10454.35

‚úÖ Purchase created successfully!
   Purchase ID: f6bca15a...
   Item Amount: 10454.35 OMR
   Total Amount: 10454.35 OMR
   Expected: 10454.35 OMR

‚úÖ TEST 1 PASSED: Amount correctly calculated using 22K valuation
   ‚úì Entered purity (999K) was stored but NOT used in calculation
   ‚úì Valuation used 916 purity (22K) as required

================================================================================
TEST 2: Multiple Items with Different Purities (All 22K Valuation)
================================================================================

üìù Test Data (Conversion Factor: 0.917):
   Item 1: 5.0g at 999K ‚Üí 4994.55 OMR (using 916K)
   Item 2: 7.5g at 916K ‚Üí 7491.82 OMR (using 916K)
   Item 3: 10.0g at 750K ‚Üí 9989.09 OMR (using 916K)
   Total Expected: 22475.46 OMR

‚úÖ Purchase created with 3 items!
   Item 1: 4994.55 OMR (expected: 4994.55)
   Item 2: 7491.82 OMR (expected: 7491.82)
   Item 3: 9989.09 OMR (expected: 9989.09)
   Total: 22475.46 OMR (expected: 22475.46)

‚úÖ TEST 2 PASSED: All items valued correctly using 22K
   ‚úì Different purities stored for reference
   ‚úì All items used 916 purity in calculation
   ‚úì Same conversion factor applied to all items

================================================================================
TEST 3: Conversion Factor Switch (0.920 vs 0.917)
================================================================================

üìù Test Data:
   Weight: 10.0g
   Entered Purity: 916K
   Expected with CF 0.920: 9956.52 OMR
   Expected with CF 0.917: 9989.09 OMR
   Difference: 32.57 OMR

‚úÖ Both purchases created successfully!
   CF 0.920: 9956.52 OMR (expected: 9956.52)
   CF 0.917: 9989.09 OMR (expected: 9989.09)

‚úÖ TEST 3 PASSED: Conversion factor correctly affects amount
   ‚úì CF 0.920 calculated correctly
   ‚úì CF 0.917 calculated correctly
   ‚úì Different CFs produce different amounts

================================================================================
TEST 4: Walk-in Purchase (No Party Creation)
================================================================================

‚úÖ Walk-in purchase created successfully!
   Purchase ID: 3ca85f0e...
   Vendor Type: walk_in
   Walk-in Name: Walk-in Vendor Test
   Vendor Party ID: None
   Parties before: 23
   Parties after: 23

‚úÖ TEST 4 PASSED: Walk-in purchase works without Party creation
   ‚úì No new Party created
   ‚úì vendor_party_id is None
   ‚úì Walk-in name stored on purchase

================================================================================
TEST 5: Walk-in Purchase with Optional Customer ID
================================================================================

‚úÖ Walk-in purchase with Customer ID created!
   Purchase ID: ee67704b...
   Walk-in Name: Walk-in Vendor with ID
   Customer ID: 12345678

‚úÖ TEST 5 PASSED: Walk-in with Customer ID works
   ‚úì Customer ID stored correctly

================================================================================
TEST 6: Finalized Purchase is Locked
================================================================================

‚úÖ Fully paid purchase created!
   Purchase ID: c66b9ad7...
   Status: draft
   Locked: False
   Balance Due: 998.64 OMR

‚ùå TEST 6 FAILED: Purchase not locked correctly

================================================================================
TEST 7: Entered Purity Does NOT Affect Valuation
================================================================================

üìù Test Data:
   Weight: 10.0g (same for all)
   Conversion Factor: 0.92 (same for all)
   Expected Amount: 9956.52 OMR (should be same for all)
   Testing purities: [750, 916, 999]
   Purity 750K ‚Üí Amount: 9956.52 OMR
   Purity 916K ‚Üí Amount: 9956.52 OMR
   Purity 999K ‚Üí Amount: 9956.52 OMR

‚úÖ TEST 7 PASSED: Entered purity does NOT affect valuation
   ‚úì All purities ([750, 916, 999]) resulted in same amount
   ‚úì All amounts matched 22K valuation: 9956.52 OMR
   ‚úì Entered purity is storage-only field

================================================================================
TEST 8: Decimal Precision (No Float Errors)
================================================================================

üìù Testing precision with edge cases:
   ‚úì Weight 10.123g, CF 0.92 ‚Üí 10078.99 OMR (expected: 10078.99)
   ‚úì Weight 7.777g, CF 0.917 ‚Üí 7768.52 OMR (expected: 7768.52)
   ‚úì Weight 15.555g, CF 0.92 ‚Üí 15487.37 OMR (expected: 15487.37)

‚úÖ TEST 8 PASSED: Decimal precision maintained
   ‚úì No floating-point rounding errors
   ‚úì All amounts calculated with precision

================================================================================
TEST SUMMARY
================================================================================
‚úÖ PASSED: TEST 1: 22K Valuation (Single Item)
‚úÖ PASSED: TEST 2: Multiple Items, Different Purities
‚úÖ PASSED: TEST 3: Conversion Factor Switch
‚úÖ PASSED: TEST 4: Walk-in Without Party
‚úÖ PASSED: TEST 5: Walk-in With Customer ID
‚ùå FAILED: TEST 6: Finalized Purchase Locked
‚úÖ PASSED: TEST 7: Entered Purity Not Used
‚úÖ PASSED: TEST 8: Decimal Precision

================================================================================
TOTAL: 7/8 tests passed

‚ö†Ô∏è 1 test(s) failed. Please review implementation.
================================================================================

